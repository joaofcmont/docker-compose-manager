<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-adsense-account" content="ca-pub-8922143154605739">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComposeFlow - Docker Compose Editor</title>

</head>
<body>
    <header>
      <nav>
        <a routerLink="/" class="logo-link">
          <img src="assets/favicon.png" alt="ComposeFlow" class="logo">
        </a>
        <ul class="nav-links">
          <li><a routerLink="/home" class="nav-link">Home</a></li>
          <li><a routerLink="/editor" class="nav-link active">Editor</a></li>
          <li><a routerLink="/templates" class="nav-link">Templates</a></li>
          <li><a routerLink="/pricing" class="nav-link">Pricing</a></li>
          <li class="contact_button"><a routerLink="/contact" class="nav-link contact-link">Contact</a></li>
        </ul>
      </nav>
    </header>
  
    <main>
      <div class="content-header">
        <h1>Docker Compose Editor</h1>
        <p class="subheading">Create, edit, and manage your Docker Compose configurations visually</p>
        
        <!-- Wizard Mode Toggle -->
        <div class="wizard-mode-toggle" *ngIf="activeTab === 'form'">
          <button 
            type="button" 
            class="btn-wizard-toggle"
            [class.active]="wizardMode"
            (click)="toggleWizardMode()"
            title="Toggle step-by-step wizard mode">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>{{ wizardMode ? 'Exit Wizard' : 'Start Wizard' }}</span>
          </button>
        </div>

        <!-- Wizard Steps Indicator -->
        <div class="wizard-progress" *ngIf="wizardMode && activeTab === 'form'">
          <div class="wizard-steps-indicator">
            <div 
              *ngFor="let step of wizardSteps; let i = index"
              class="wizard-step-indicator"
              [class.active]="wizardStep === i + 1"
              [class.completed]="isWizardStepCompleted(step)"
              (click)="goToWizardStep(i + 1)"
              [title]="wizardStepNames[step]">
              <span class="step-number">{{ i + 1 }}</span>
              <span class="step-name">{{ wizardStepNames[step] }}</span>
            </div>
          </div>
        </div>

        <!-- Wizard Step Instructions -->
        <div class="wizard-instructions" *ngIf="wizardMode && activeTab === 'form'">
          <div class="wizard-instruction-content">
            <div class="wizard-instruction-header">
              <div>
                <h3>{{ wizardStepNames[getCurrentWizardStep()] }}</h3>
                <p>{{ wizardStepDescriptions[getCurrentWizardStep()] }}</p>
              </div>
              <button 
                type="button" 
                class="btn-wizard-help"
                (click)="showWizardHelp = !showWizardHelp"
                [title]="showWizardHelp ? 'Hide tips' : 'Show tips'">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="16" x2="12" y2="12"></line>
                  <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                <span>{{ showWizardHelp ? 'Hide Tips' : 'Show Tips' }}</span>
              </button>
            </div>
            
            <!-- Wizard Help Panel -->
            <div class="wizard-help-panel" *ngIf="showWizardHelp && wizardStepHelp[getCurrentWizardStep()]">
              <div class="wizard-help-content">
                <h4>{{ wizardStepHelp[getCurrentWizardStep()].title }}</h4>
                <ul class="wizard-help-tips">
                  <li *ngFor="let tip of wizardStepHelp[getCurrentWizardStep()].tips">{{ tip }}</li>
                </ul>
                <div class="wizard-help-example" *ngIf="wizardStepHelp[getCurrentWizardStep()].examples">
                  <strong>Example:</strong>
                  <code>{{ wizardStepHelp[getCurrentWizardStep()].examples }}</code>
                </div>
              </div>
            </div>

            <!-- Validation Errors -->
            <div class="wizard-validation-errors" *ngIf="wizardMode && getWizardStepValidationErrors().length > 0">
              <div class="validation-error-header">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <strong>Please fix the following errors before continuing:</strong>
              </div>
              <ul class="validation-error-list">
                <li *ngFor="let error of getWizardStepValidationErrors()">{{ error }}</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
  
      <section id="import-section">
        <p>Upload your Docker Compose YAML file or exported JSON configuration to start working with it.</p>
        <div class="file-upload">
          <input 
            type="file" 
            (change)="onFileSelected($event)" 
            accept=".yaml,.yml,.json" 
            id="file-upload"
            class="file-input"
            [disabled]="isImporting">
          <label for="file-upload" class="file-label" [class.loading]="isImporting">
            <span *ngIf="!isImporting">Choose File (YAML or JSON)</span>
            <span *ngIf="isImporting" class="loading-text">
              <span class="spinner-small"></span>
              Importing...
            </span>
          </label>
        </div>
        <div class="advanced-features-note" *ngIf="hasAdvancedFeatures">
          <span class="note-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></span>
          <span>{{ advancedFeaturesNote }}</span>
        </div>
      </section>
  
      <div class="container">
        <!-- Tabs Navigation -->
        <div class="tabs-navigation">
          <div class="tabs-left">
            <button 
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'form'"
              (click)="setActiveTab('form')">
              Form
            </button>
            <button 
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'diagram'"
              (click)="setActiveTab('diagram')">
              Diagram
            </button>
            <button 
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'yaml'"
              (click)="setActiveTab('yaml')">
              YAML Preview
            </button>
            <button 
              type="button"
              class="tab-button"
              [class.active]="activeTab === 'commands'"
              (click)="setActiveTab('commands')">
              Commands
            </button>
          </div>
          <div class="tab-actions">
            <!-- Environment Switcher -->
            <div class="environment-switcher" *ngIf="environments.length > 0">
              <label for="environment-select" class="env-label">Environment:</label>
              <select 
                id="environment-select"
                [(ngModel)]="currentEnvironment"
                (change)="switchEnvironment(currentEnvironment)"
                [ngModelOptions]="{standalone: true}"
                class="env-select">
                <option value="base">Base</option>
                <option *ngFor="let env of environments" [value]="env.name" [disabled]="env.name === 'base'">
                  {{ env.name | titlecase }}{{ env.profile ? ' (' + env.profile + ')' : '' }}
                </option>
              </select>
              <button 
                type="button"
                class="btn-env-manage"
                (click)="showEnvironmentModal = true"
                title="Manage environments">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"></path>
                </svg>
              </button>
              <button 
                type="button"
                class="btn-env-diff"
                (click)="showEnvironmentDiff = true"
                *ngIf="environments.length > 1"
                title="Compare environments">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
              </button>
            </div>
            <button 
              type="button"
              class="btn-export-import"
              (click)="generateShareableLink()"
              [disabled]="services.length === 0"
              title="Generate shareable link">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                <polyline points="16 6 12 2 8 6"></polyline>
                <line x1="12" y1="2" x2="12" y2="15"></line>
              </svg>
              Share
            </button>
            <button 
              type="button"
              class="btn-export-import"
              (click)="exportConfigAsJson()"
              [disabled]="services.length === 0"
              title="Export configuration as JSON">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Export JSON
            </button>
            <button 
              type="button"
              class="btn-export-import"
              [class.pro-feature]="!isPro"
              (click)="exportAsDockerRunCommands()"
              [disabled]="services.length === 0"
              title="Export as Docker Run commands (Pro feature)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="16 18 22 12 16 6"></polyline>
                <polyline points="8 6 2 12 8 18"></polyline>
              </svg>
              Export Run Cmds
              <span class="pro-badge-small" *ngIf="!isPro">Pro</span>
            </button>
            <button 
              type="button"
              class="btn-template"
              (click)="quickSaveTemplate()"
              [disabled]="isSavingTemplate || services.length === 0"
              title="Quick save current configuration as template">
              <span *ngIf="!isSavingTemplate">Save Template</span>
              <span *ngIf="isSavingTemplate" class="button-loading">
                <span class="spinner-small"></span>
                Saving...
              </span>
            </button>
            <button 
              type="button"
              class="btn-learning-center"
              (click)="openLearningCenter()"
              title="Open Learning Center">
              Learning Center
            </button>
            <button 
              type="button"
              class="btn-suggestions"
              *ngIf="getConfigSuggestions().length > 0"
              (click)="openSuggestionsPopup()"
              [title]="'View ' + getConfigSuggestions().length + ' configuration suggestions'">
              Suggestions ({{ getConfigSuggestions().length }})
            </button>
          </div>
        </div>

        <!-- Tab Content Wrapper -->
        <div class="tab-content-wrapper">
          <!-- Learning Panel (can be shown alongside form) -->
          <div class="learning-panel" *ngIf="showLearningPanel && activeTab === 'form'">
            <div class="learning-panel-header">
              <h3>
                <span *ngIf="activeFieldTips.length > 0">Tips: {{ activeFieldName }}</span>
                <span *ngIf="activeFieldTips.length === 0">Learning Center</span>
              </h3>
              <button type="button" class="btn-close-panel" (click)="toggleLearningPanel()">√ó</button>
            </div>
            
            <div class="learning-panel-content">
              <!-- Field-specific tips -->
              <div class="tips-section" *ngIf="activeFieldTips.length > 0">
                <div *ngFor="let tip of activeFieldTips" class="tip-item" [class]="'tip-' + tip.category">
                  <div class="tip-header">
                    <strong>{{ tip.title }}</strong>
                    <a *ngIf="tip.link" [href]="tip.link" target="_blank" class="tip-link" title="View documentation">
                      üìñ Docs
                    </a>
                  </div>
                  <p>{{ tip.message }}</p>
                </div>
              </div>

              <!-- Config Suggestions -->
              <div class="suggestions-section" *ngIf="getConfigSuggestions().length > 0 && activeFieldTips.length === 0">
                <h4>Configuration Suggestions</h4>
                <div *ngFor="let suggestion of getConfigSuggestions()" class="suggestion-item" [class]="'suggestion-' + suggestion.type">
                  <div class="suggestion-header">
                    <span class="suggestion-icon">
                      <span *ngIf="suggestion.type === 'error'">‚ùå</span>
                      <span *ngIf="suggestion.type === 'warning'">‚ö†Ô∏è</span>
                      <span *ngIf="suggestion.type === 'suggestion'">üí°</span>
                      <span *ngIf="suggestion.type === 'optimization'">‚ö°</span>
                    </span>
                    <strong>{{ suggestion.title }}</strong>
                    <span class="severity-badge" [class]="'severity-' + suggestion.severity">
                      {{ suggestion.severity }}
                    </span>
                  </div>
                  <p>{{ suggestion.message }}</p>
                  <div class="suggestion-fix" *ngIf="suggestion.fix">
                    <strong>Fix:</strong> {{ suggestion.fix }}
                  </div>
                </div>
              </div>

              <!-- Quick References -->
              <div class="references-section" *ngIf="activeFieldTips.length === 0 && getConfigSuggestions().length === 0">
                <h4>Quick References</h4>
                <div *ngFor="let category of getQuickReferences()" class="reference-category">
                  <h5>{{ category.category }}</h5>
                  <div *ngFor="let example of category.examples" class="reference-example">
                    <strong>{{ example.title }}</strong>
                    <p class="reference-description">{{ example.description }}</p>
                    <pre class="reference-yaml"><code>{{ example.yaml }}</code></pre>
                  </div>
                </div>
              </div>

              <!-- Best Practices -->
              <div class="best-practices-section" *ngIf="activeFieldTips.length === 0 && getConfigSuggestions().length === 0">
                <h4>Best Practices</h4>
                <div *ngFor="let category of getBestPractices()" class="practice-category">
                  <h5>{{ category.category }}</h5>
                  <div *ngFor="let practice of category.practices" class="practice-item">
                    <strong>{{ practice.title }}</strong>
                    <p>{{ practice.description }}</p>
                    <a *ngIf="practice.link" [href]="practice.link" target="_blank" class="practice-link">
                      Learn more ‚Üí
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Service List Sidebar (shown in form and diagram tabs) -->
          <div class="service-list-sidebar" *ngIf="activeTab === 'form' || activeTab === 'diagram'">
          <div class="service-list-header">
            <div class="service-header-title">
              <h3>Services</h3>
              <span class="service-count-badge" *ngIf="services.length > 0" [title]="services.length + ' service' + (services.length > 1 ? 's' : '')">
                {{ services.length }}
              </span>
            </div>
            <div class="service-header-actions">
              <div class="undo-redo-buttons">
                <button 
                  type="button" 
                  class="btn-undo"
                  (click)="undo()"
                  [disabled]="!canUndo()"
                  title="Undo (Ctrl+Z)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7v6h6"></path>
                    <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
                  </svg>
                </button>
                <button 
                  type="button" 
                  class="btn-redo"
                  (click)="redo()"
                  [disabled]="!canRedo()"
                  title="Redo (Ctrl+Y or Ctrl+Shift+Z)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 7v6h-6"></path>
                    <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13"></path>
                  </svg>
                </button>
              </div>
              <button 
                type="button" 
                class="btn-add-service" 
                (click)="addNewService()" 
                [disabled]="!canAddMoreServices"
                title="Add a new service to your Docker Compose configuration">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>Add Service</span>
              </button>
            </div>
            <!-- Service Limit Indicator -->
            <div class="service-limit-indicator" *ngIf="!isPro">
              <div class="limit-info">
                <span class="limit-text">
                  {{ services.length }} / {{ serviceLimit }} services
                  <span *ngIf="servicesRemaining === 0" class="limit-reached">(Limit reached)</span>
                </span>
                <a routerLink="/pricing" class="upgrade-link" (click)="trackUpgradeClick('service_limit')">
                  Upgrade to Pro
                </a>
              </div>
            </div>
            <!-- Pro Badge -->
            <div class="pro-badge" *ngIf="isPro">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                <path d="M2 17l10 5 10-5"></path>
                <path d="M2 12l10 5 10-5"></path>
              </svg>
              <span>Pro</span>
            </div>
            <div class="multi-service-hint" *ngIf="services.length === 1 && !hasSeenMultiServiceHint">
              <span class="hint-icon">üí°</span>
              <span class="hint-text">You can add multiple services to build complex multi-container applications!</span>
              <button type="button" class="hint-close" (click)="dismissMultiServiceHint()" title="Dismiss">√ó</button>
            </div>
          </div>
          
          <!-- Service Search -->
          <div class="service-search" *ngIf="services.length > 3">
            <div class="search-input-wrapper">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input 
                type="text" 
                class="service-search-input"
                placeholder="Search services..."
                [(ngModel)]="serviceSearchQuery"
                [ngModelOptions]="{standalone: true}">
              <button 
                type="button" 
                class="search-clear"
                *ngIf="serviceSearchQuery"
                (click)="clearServiceSearch()"
                title="Clear search">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
          </div>

          <!-- Resource Usage Summary -->
          <div class="resource-summary" *ngIf="services.length > 0">
            <div class="resource-summary-header">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                <line x1="8" y1="21" x2="16" y2="21"></line>
                <line x1="12" y1="17" x2="12" y2="21"></line>
              </svg>
              <span class="resource-summary-title">Total Resources</span>
            </div>
            <div class="resource-summary-content">
              <div class="resource-item">
                <span class="resource-label">CPU:</span>
                <span class="resource-value">{{ totalCpu.toFixed(1) }} cores</span>
              </div>
              <div class="resource-item">
                <span class="resource-label">Memory:</span>
                <span class="resource-value">{{ (totalMemory / 1024).toFixed(2) }} GB</span>
              </div>
            </div>
          </div>

          <div class="service-list">
            <div 
              *ngFor="let service of getFilteredServices(); let i = index" 
              class="service-item"
              [class.selected]="services.indexOf(service) === selectedServiceIndex"
              [class.dragging]="draggedServiceIndex === services.indexOf(service)"
              [class]="getServiceStatusClass(service)"
              [draggable]="true"
              (dragstart)="onServiceDragStart($event, services.indexOf(service))"
              (dragover)="onServiceDragOver($event, services.indexOf(service))"
              (drop)="onServiceDrop($event, services.indexOf(service))"
              (dragend)="onServiceDragEnd()"
              (click)="selectService(services.indexOf(service))">
              <div class="service-item-content">
                <span class="drag-handle" title="Drag to reorder">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="12" r="1"></circle>
                    <circle cx="9" cy="5" r="1"></circle>
                    <circle cx="9" cy="19" r="1"></circle>
                    <circle cx="15" cy="12" r="1"></circle>
                    <circle cx="15" cy="5" r="1"></circle>
                    <circle cx="15" cy="19" r="1"></circle>
                  </svg>
                </span>
                <span class="service-status-badge" [class]="getServiceStatusClass(service)" [title]="'Status: ' + getServiceStatus(service)">
                  {{ getServiceStatusIcon(service) }}
                </span>
                <span class="service-icon">
                  <svg-icon [type]="getServiceIcon(service)"></svg-icon>
                </span>
                <span class="service-name">{{ service.serviceName || 'Unnamed Service' }}</span>
              </div>
              <div class="service-item-actions" (click)="$event.stopPropagation()">
                <button 
                  type="button" 
                  class="btn-duplicate" 
                  (click)="duplicateService()"
                  *ngIf="i === selectedServiceIndex"
                  title="Duplicate Service">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
                <button 
                  type="button" 
                  class="btn-delete" 
                  (click)="deleteService(i)"
                  [disabled]="services.length <= 1"
                  title="Delete Service">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
              </div>
            </div>
            </div>
          </div>

          <!-- Form Tab Content -->
        <div class="form-container" *ngIf="activeTab === 'form'">
          <!-- Quick Start Templates Section -->
          <div class="quick-start-templates" *ngIf="services.length === 0 || (services.length === 1 && !services[0].serviceName && !services[0].dockerImage)">
            <h3>Quick Start: Choose a Template</h3>
            <p class="templates-subtitle">Get started quickly with a pre-configured service template</p>
            <div class="template-cards">
              <div 
                class="template-card" 
                *ngFor="let template of getAvailableTemplates()"
                (click)="selectTemplate(template.name)">
                <div class="template-icon">
                  <svg-icon [type]="template.icon"></svg-icon>
                </div>
                <div class="template-info">
                  <h4>{{ template.displayName }}</h4>
                  <p>{{ getTemplateDescription(template.name) }}</p>
                </div>
                <button type="button" class="template-select-btn">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                  </svg>
                </button>
              </div>
            </div>
            <div class="templates-divider">
              <span>or</span>
            </div>
          </div>

          <form [formGroup]="composeForm" (ngSubmit)="generateDockerComposeFile()">
            <!-- Basic Service Configuration -->
            <div class="form-section collapsible" [class.expanded]="expandedSections.basic">
              <div class="section-header" (click)="toggleSection('basic')">
                <h3>Basic Configuration</h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="section-toggle-icon">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="section-content">
              <div class="form-group">
                <label for="serviceTemplate">Service Template</label>
                <select id="serviceTemplate" formControlName="serviceTemplate">
                  <option value="">Select a template</option>
                  <option value="nginx">Nginx</option>
                  <option value="postgres">PostgreSQL</option>
                  <option value="redis">Redis</option>
                </select>
              </div>
  
              <div class="form-group">
                <label for="serviceName">
                  Service Name <span class="required">*</span>
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('serviceName')"
                    title="Get tips for this field">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="16" x2="12" y2="12"></line>
                      <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                  </button>
                </label>
                <div class="input-with-example">
                  <input 
                    type="text" 
                    id="serviceName" 
                    formControlName="serviceName"
                    placeholder="e.g., web-server, database, api"
                    [class.error]="composeForm.get('serviceName')?.invalid && composeForm.get('serviceName')?.touched">
                  <button 
                    type="button" 
                    class="btn-example"
                    (click)="applyExample('serviceName', 'web-server')"
                    title="Use example">
                    Example
                  </button>
                </div>
                <div class="error-message" *ngIf="getErrorMessage('serviceName') as error">
                  <div class="error-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="error-icon">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <div class="error-text">
                      <strong>{{ error.message }}</strong>
                      <span class="error-suggestion" *ngIf="error.suggestion">{{ error.suggestion }}</span>
                    </div>
                  </div>
                </div>
              </div>
  
              <div class="form-group">
                <label for="dockerImage">
                  Docker Image <span class="required">*</span>
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('dockerImage')"
                    title="Get tips for this field">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  </button>
                </label>
                <div class="input-with-example">
                  <input 
                    type="text" 
                    id="dockerImage" 
                    formControlName="dockerImage"
                    placeholder="e.g., nginx:latest, postgres:15, node:18"
                    [class.error]="composeForm.get('dockerImage')?.invalid && composeForm.get('dockerImage')?.touched">
                  <button 
                    type="button" 
                    class="btn-example"
                    (click)="applyExample('dockerImage', 'nginx:latest')"
                    title="Use example">
                    Example
                  </button>
                </div>
                <div class="error-message" *ngIf="getErrorMessage('dockerImage') as error">
                  <div class="error-content">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="error-icon">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <div class="error-text">
                      <strong>{{ error.message }}</strong>
                      <span class="error-suggestion" *ngIf="error.suggestion">{{ error.suggestion }}</span>
                    </div>
                  </div>
                </div>
              </div>
  
              <div class="form-group grid-2">
                <div>
                  <label for="hostPort">
                    Host Port <span class="required">*</span>
                    <button 
                      type="button" 
                      class="help-trigger"
                      (click)="showTipsForField('hostPort')"
                      title="Get tips for this field">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                  </label>
                  <input 
                    type="number" 
                    id="hostPort" 
                    formControlName="hostPort"
                    placeholder="Port to expose on host" 
                    [class.error]="composeForm.get('hostPort')?.invalid && composeForm.get('hostPort')?.touched"
                    min="1" 
                    max="65535">
                  <div class="error-message" *ngIf="getErrorMessage('hostPort') as error">
                    <div class="error-content">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="error-icon">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                      </svg>
                      <div class="error-text">
                        <strong>{{ error.message }}</strong>
                        <span class="error-suggestion" *ngIf="error.suggestion">{{ error.suggestion }}</span>
                      </div>
                    </div>
                  </div>
                  <!-- Port conflict warning -->
                  <div class="port-conflict-warning" *ngIf="hasPortConflict() && composeForm.get('hostPort')?.valid && composeForm.get('hostPort')?.touched">
                    <div class="warning-content">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="warning-icon">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                      </svg>
                      <div class="warning-text">
                        <strong>Port Conflict:</strong> Port {{ composeForm.get('hostPort')?.value }} is already used by: {{ getConflictingServiceNames().join(', ') }}
                      </div>
                    </div>
                  </div>
                </div>
                <div>
                  <label for="containerPort">
                    Container Port <span class="required">*</span>
                    <button 
                      type="button" 
                      class="help-trigger"
                      (click)="showTipsForField('containerPort')"
                      title="Get tips for this field">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                  </label>
                  <input 
                    type="number" 
                    id="containerPort" 
                    formControlName="containerPort"
                    placeholder="Port inside container" 
                    [class.error]="composeForm.get('containerPort')?.invalid && composeForm.get('containerPort')?.touched"
                    min="1" 
                    max="65535">
                  <div class="error-message" *ngIf="getErrorMessage('containerPort') as error">
                    <div class="error-content">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="error-icon">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                      </svg>
                      <div class="error-text">
                        <strong>{{ error.message }}</strong>
                        <span class="error-suggestion" *ngIf="error.suggestion">{{ error.suggestion }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              </div>
            </div>
  
            <!-- Environment and Volumes -->
            <div class="form-section collapsible" 
                 [class.expanded]="!wizardMode ? expandedSections.configuration : isWizardStepActive('configuration')"
                 [class.wizard-active]="wizardMode && isWizardStepActive('configuration')"
                 [class.wizard-completed]="wizardMode && isWizardStepCompleted('configuration')"
                 *ngIf="!wizardMode || isWizardStepActive('configuration') || isWizardStepCompleted('configuration')">
              <div class="section-header" (click)="!wizardMode && toggleSection('configuration')">
                <h3>Configuration</h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="section-toggle-icon" *ngIf="!wizardMode">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                <span class="wizard-step-badge" *ngIf="wizardMode">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepActive('configuration')">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepCompleted('configuration')">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </span>
              </div>
              <div class="section-content" *ngIf="!wizardMode || isWizardStepActive('configuration')">
              <div class="form-group">
                  <label for="environment">
                    Environment Variables
                    <button 
                      type="button" 
                      class="help-trigger"
                      (click)="showTipsForField('environment')"
                      title="Get tips for this field">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                  </label>
                  <div class="presets-section" *ngIf="getEnvironmentPresets().length > 0">
                    <small class="presets-label">Quick presets:</small>
                    <div class="preset-buttons-small">
                      <button 
                        *ngFor="let preset of getEnvironmentPresets()"
                        type="button" 
                        class="preset-btn-small"
                        (click)="applyEnvironmentPreset(preset)"
                        [title]="preset.description">
                        {{ preset.name }}
                      </button>
                    </div>
                  </div>
                <textarea 
                  id="environment" 
                  formControlName="environment"
                  rows="3" 
                  placeholder="KEY=value&#10;ANOTHER_KEY=value"></textarea>
                <small class="help-text">One variable per line (e.g., NODE_ENV=production)</small>
              </div>
  
              <div class="form-group">
                  <label for="volumes">
                    Volumes
                    <button 
                      type="button" 
                      class="help-trigger"
                      (click)="showTipsForField('volumes')"
                      title="Get tips for this field">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                  </label>
                  <div class="presets-section" *ngIf="getVolumePresets().length > 0">
                    <small class="presets-label">Quick presets:</small>
                    <div class="preset-buttons-small">
                      <button 
                        *ngFor="let preset of getVolumePresets()"
                        type="button" 
                        class="preset-btn-small"
                        (click)="applyVolumePreset(preset)"
                        [title]="preset.description">
                        {{ preset.name }}
                      </button>
                    </div>
                  </div>
                <textarea 
                  id="volumes" 
                  formControlName="volumes"
                  rows="2" 
                  placeholder="./local/path:/container/path&#10;named-volume:/container/path"></textarea>
                <small class="help-text">One volume mapping per line</small>
              </div>
            </div>
  
<!-- Health Check Configuration -->
<div class="form-section collapsible" 
     [class.expanded]="!wizardMode ? expandedSections.healthcheck : isWizardStepActive('healthcheck')"
     [class.wizard-active]="wizardMode && isWizardStepActive('healthcheck')"
     [class.wizard-completed]="wizardMode && isWizardStepCompleted('healthcheck')"
     *ngIf="!wizardMode || isWizardStepActive('healthcheck') || isWizardStepCompleted('healthcheck')"
     formGroupName="healthCheck">
    <div class="section-header" (click)="!wizardMode && toggleSection('healthcheck')">
      <h3>
        Health Check
        <button 
          type="button" 
          class="help-trigger"
          (click)="showTipsForField('healthCheck')"
          title="Get tips for health checks">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
        </button>
      </h3>
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="section-toggle-icon" [class.rotated]="!expandedSections.healthcheck" *ngIf="!wizardMode">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
      <span class="wizard-step-badge" *ngIf="wizardMode">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepActive('healthcheck')">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepCompleted('healthcheck')">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </span>
    </div>
    <div class="section-content" *ngIf="!wizardMode || isWizardStepActive('healthcheck')">
    <div class="form-group checkbox">
      <button 
        type="button" 
        class="toggle-button" 
        [class.active]="composeForm.get('healthCheck.enabled')?.value" 
        (click)="toggleHealthCheck()">
        {{ composeForm.get('healthCheck.enabled')?.value ? 'Disable Health Check' : 'Enable Health Check' }}
      </button>
    </div>
  
    <div class="health-check-options" *ngIf="composeForm.get('healthCheck.enabled')?.value">
      <div class="form-group grid-3">
        <div>
          <label for="healthCheckInterval">Interval</label>
          <input 
            type="text" 
            id="healthCheckInterval" 
            formControlName="interval"
            placeholder="30s">
          <small class="help-text">How often to check (e.g., 30s, 1m)</small>
        </div>
        <div>
          <label for="healthCheckTimeout">Timeout</label>
          <input 
            type="text" 
            id="healthCheckTimeout" 
            formControlName="timeout"
            placeholder="10s">
          <small class="help-text">Max wait time (e.g., 10s, 5m)</small>
        </div>
        <div>
          <label for="healthCheckRetries">Retries</label>
          <input 
            type="number" 
            id="healthCheckRetries" 
            formControlName="retries"
            placeholder="3"
            min="0">
          <small class="help-text">Failures before marking unhealthy</small>
        </div>
        <div>
          <label for="healthCheckStartPeriod">
            Start Period
            <span class="help-icon" title="Time to wait before starting health checks (e.g., 40s, 1m). Useful for services that need time to initialize."><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></span>
          </label>
          <input 
            type="text" 
            id="healthCheckStartPeriod" 
            formControlName="startPeriod"
            placeholder="40s">
          <small class="help-text">Wait time before first check (optional)</small>
        </div>
      </div>
      <div class="form-group">
        <label for="healthCheckTest">
          Test Command
          <span class="help-icon" title="Custom health check command. Leave empty to auto-detect based on image type."><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></span>
        </label>
        <div class="healthcheck-test-options">
          <select 
            id="healthCheckTestPreset" 
            (change)="applyHealthCheckTestPreset($any($event.target).value)"
            [value]="''">
            <option value="">Auto-detect (recommended)</option>
            <optgroup label="Common Services">
              <option value="nginx">Nginx (curl)</option>
              <option value="postgres">PostgreSQL (pg_isready)</option>
              <option value="mysql">MySQL (mysqladmin ping)</option>
              <option value="redis">Redis (redis-cli ping)</option>
              <option value="mongo">MongoDB (mongosh ping)</option>
              <option value="node">Node.js (curl /health)</option>
              <option value="http">HTTP Endpoint (curl)</option>
            </optgroup>
            <optgroup label="Custom Commands">
              <option value="CMD-SHELL">CMD-SHELL (custom command)</option>
              <option value="CMD">CMD (command array)</option>
              <option value="NONE">NONE (disable)</option>
            </optgroup>
          </select>
          <div *ngIf="getHealthCheckTestArray().length > 0" class="test-command-display">
            <div *ngFor="let cmd of getHealthCheckTestArray(); let i = index" class="test-command-item">
              <input 
                type="text" 
                [value]="cmd"
                (blur)="updateTestCommand(i, $any($event.target).value)"
                placeholder="Command or argument">
              <button 
                type="button" 
                class="btn-remove-test"
                (click)="removeTestCommand(i)"
                *ngIf="getHealthCheckTestArray().length > 1">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <button 
              type="button" 
              class="btn-add-test-arg"
              (click)="addTestCommand()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Add Argument
            </button>
          </div>
        </div>
        <small class="help-text">
          Custom health check command. Auto-detection works for: HTTP (curl/wget), PostgreSQL (pg_isready), Redis (redis-cli ping), MySQL (mysqladmin ping).
        </small>
      </div>
    </div>
    </div>
    </div>
  </div>
    
  
            <!-- Resources and Deployment -->
            <div class="form-section collapsible" 
                 [class.expanded]="!wizardMode ? expandedSections.resources : isWizardStepActive('resources')"
                 [class.wizard-active]="wizardMode && isWizardStepActive('resources')"
                 [class.wizard-completed]="wizardMode && isWizardStepCompleted('resources')"
                 *ngIf="!wizardMode || isWizardStepActive('resources') || isWizardStepCompleted('resources')">
              <div class="section-header" (click)="!wizardMode && toggleSection('resources')">
                <h3>Resources & Deployment</h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="section-toggle-icon" *ngIf="!wizardMode">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
                <span class="wizard-step-badge" *ngIf="wizardMode">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepActive('resources')">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" *ngIf="isWizardStepCompleted('resources')">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </span>
              </div>
              <div class="section-content" *ngIf="!wizardMode || isWizardStepActive('resources')">
              <div formGroupName="resources">
                <div class="form-group grid-2">
                  <div>
                    <label for="cpuLimit">
                      CPU Limit
                      <button 
                        type="button" 
                        class="help-trigger"
                        (click)="showTipsForField('cpuLimit')"
                        title="Get tips for CPU limits">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                      </button>
                    </label>
                    <div class="preset-buttons">
                      <button type="button" class="preset-btn" (click)="applyResourcePreset('low')">Low (0.5)</button>
                      <button type="button" class="preset-btn" (click)="applyResourcePreset('medium')">Medium (1.0)</button>
                      <button type="button" class="preset-btn" (click)="applyResourcePreset('high')">High (2.0)</button>
                    </div>
                    <input 
                      type="number" 
                      id="cpuLimit" 
                      formControlName="cpuLimit"
                      placeholder="0.5"
                      step="0.1"
                      [class.error]="composeForm.get('resources.cpuLimit')?.invalid && composeForm.get('resources.cpuLimit')?.touched">
                    <small class="help-text">Examples: 0.5 = half core, 1.0 = 1 core, 2.5 = 2.5 cores</small>
                    <small class="error-text" *ngIf="composeForm.get('resources.cpuLimit')?.invalid && composeForm.get('resources.cpuLimit')?.touched">
                      {{ getFieldError('resources.cpuLimit') }}
                    </small>
                  </div>
                  <div>
                      <label for="memoryLimit">
                        Memory Limit (MB)
                        <button 
                          type="button" 
                          class="help-trigger"
                          (click)="showTipsForField('memoryLimit')"
                          title="Get tips for memory limits">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                        </button>
                      </label>
                    <input 
                      type="number" 
                      id="memoryLimit" 
                      formControlName="memoryLimit"
                      placeholder="512"
                      min="0"
                      [class.error]="composeForm.get('resources.memoryLimit')?.invalid && composeForm.get('resources.memoryLimit')?.touched">
                    <small class="help-text">Examples: 512MB, 1024MB (1GB), 2048MB (2GB)</small>
                    <small class="error-text" *ngIf="composeForm.get('resources.memoryLimit')?.invalid && composeForm.get('resources.memoryLimit')?.touched">
                      {{ getFieldError('resources.memoryLimit') }}
                    </small>
                  </div>
                </div>
              </div>
  
              <div class="form-group grid-2">
                <div formGroupName="deploy">
                  <label for="replicas">Replicas</label>
                  <input 
                    type="number" 
                    id="replicas" 
                    formControlName="replicas"
                    placeholder="1" 
                    min="1">
                </div>
                <div>
                  <label for="restart">
                    Restart Policy
                    <button 
                      type="button" 
                      class="help-trigger"
                      (click)="showTipsForField('restart')"
                      title="Get tips for restart policies">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                  </label>
                  <select id="restart" formControlName="restart">
                    <option value="always">Always</option>
                    <option value="unless-stopped">Unless Stopped</option>
                    <option value="on-failure">On Failure</option>
                    <option value="no">No</option>
                  </select>
                  <small class="help-text">always = restart on failure, unless-stopped = restart unless manually stopped</small>
                </div>
              </div>
  
              <div class="form-group">
                <label for="depends_on">
                  Dependencies
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('depends_on')"
                    title="Get tips for dependencies">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  </button>
                </label>
                <div class="dependencies-checkboxes" *ngIf="getAvailableServicesForDependencies().length > 0">
                  <div 
                    *ngFor="let service of getAvailableServicesForDependencies()" 
                    class="dependency-checkbox-item">
                    <input 
                      type="checkbox" 
                      [id]="'dep-' + service.serviceName"
                      [checked]="isServiceInDependencies(service.serviceName)"
                      (change)="toggleDependency(service.serviceName)">
                    <label [for]="'dep-' + service.serviceName">
                      <span class="service-icon-small">{{ getServiceIcon(service) }}</span>
                      {{ service.serviceName }}
                    </label>
                  </div>
                </div>
                <div *ngIf="getAvailableServicesForDependencies().length === 0" class="no-dependencies">
                  <small class="help-text">Add more services to set dependencies</small>
                </div>
                <small class="help-text" *ngIf="getAvailableServicesForDependencies().length > 0">
                  Select services this service depends on. They will start before this service.
                </small>
              </div>

              <div class="form-group">
                <label for="networks">
                  Networks
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('networks')"
                    title="Get tips for networks">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  </button>
                </label>
                <div class="networks-checkboxes" *ngIf="getAllNetworks().length > 0">
                  <div 
                    *ngFor="let network of getAllNetworks()" 
                    class="network-checkbox-item">
                    <input 
                      type="checkbox" 
                      [id]="'net-' + network"
                      [checked]="isNetworkSelected(network)"
                      (change)="toggleNetwork(network)">
                    <label [for]="'net-' + network">
                      {{ network }}
                    </label>
                  </div>
                </div>
                <div class="networks-actions">
                  <button 
                    type="button" 
                    class="btn-add-network"
                    (click)="addNewNetwork()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Network
                  </button>
                </div>
                <small class="help-text">
                  Select networks this service should connect to. Click "Add Network" to create a new network.
                </small>
              </div>

              <div class="form-group">
                <label for="labels">
                  Labels
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('labels')"
                    title="Get tips for labels">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  </button>
                </label>
                <div class="labels-section">
                  <div class="labels-presets" *ngIf="getLabelsArray().length === 0">
                    <small class="help-text" style="margin-bottom: 0.5rem; display: block;">Common labels:</small>
                    <div class="preset-buttons">
                      <button 
                        *ngFor="let preset of getCommonLabelPresets()"
                        type="button" 
                        class="preset-btn-small"
                        (click)="applyLabelPreset(preset)"
                        [title]="preset.description">
                        {{ preset.key }}
                      </button>
                    </div>
                  </div>
                  <div class="labels-list" *ngIf="getLabelsArray().length > 0">
                    <div 
                      *ngFor="let label of getLabelsArray(); let i = index" 
                      class="label-item">
                      <input 
                        type="text" 
                        class="label-key"
                        [value]="label.key"
                        (blur)="updateLabelKey(label.key, $any($event.target).value)"
                        placeholder="Label key"
                        [class.error]="!isLabelKeyValid(label.key)">
                      <span class="label-separator">=</span>
                      <input 
                        type="text" 
                        class="label-value"
                        [value]="label.value"
                        (blur)="updateLabelValue(label.key, $any($event.target).value)"
                        placeholder="Label value">
                      <button 
                        type="button" 
                        class="btn-remove-label"
                        (click)="removeLabel(label.key)"
                        title="Remove label">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="18" y1="6" x2="6" y2="18"></line>
                          <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <button 
                    type="button" 
                    class="btn-add-label"
                    (click)="addNewLabel()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Label
                  </button>
                </div>
                <small class="help-text">
                  Add key-value pairs for service metadata. Common labels: com.docker.compose.project, traefik.*, etc.
                </small>
              </div>

              <!-- Service Notes -->
              <div class="form-group">
                <label for="notes">
                  Service Notes
                  <button 
                    type="button" 
                    class="help-trigger"
                    (click)="showTipsForField('notes')"
                    title="Get tips for this field">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                  </button>
                </label>
                <textarea 
                  id="notes" 
                  formControlName="notes"
                  rows="3" 
                  placeholder="Add notes or comments about this service (e.g., purpose, configuration details, etc.)"></textarea>
                <small class="help-text">Optional: Add documentation or notes about this service. These notes are saved in exported JSON files.</small>
              </div>
              </div>
            </div>
  
              <!-- Wizard Navigation -->
              <div class="wizard-navigation" *ngIf="wizardMode">
                <div class="wizard-nav-buttons">
                  <button 
                    type="button" 
                    class="btn-wizard-nav btn-prev"
                    (click)="previousWizardStep()"
                    [disabled]="wizardStep === 1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    Previous
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn-wizard-nav btn-skip"
                    (click)="skipWizardStep()"
                    [disabled]="wizardStep === wizardSteps.length || getCurrentWizardStep() === 'review'">
                    Skip
                  </button>
                  
                  <button 
                    type="button" 
                    class="btn-wizard-nav btn-next"
                    (click)="nextWizardStep()"
                    [disabled]="wizardStep === wizardSteps.length">
                    Next
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                  </button>
                  
                  <button 
                    type="submit" 
                    class="btn-wizard-nav btn-generate"
                    *ngIf="wizardMode && getCurrentWizardStep() === 'review'"
                    [disabled]="composeForm.invalid || isGenerating">
                    <span *ngIf="!isGenerating">Generate Docker Compose File</span>
                    <span *ngIf="isGenerating" class="button-loading">
                      <span class="spinner-small"></span>
                      Generating...
                    </span>
                  </button>
                </div>
              </div>

              <!-- Regular Form Actions (shown when not in wizard mode) -->
              <div class="form-actions" *ngIf="!wizardMode">
                <button type="button" class="secondary" (click)="resetForm()" [disabled]="isGenerating">Reset</button>
                <button type="submit" class="primary" [disabled]="composeForm.invalid || isGenerating">
                  <span *ngIf="!isGenerating">Generate Docker Compose File</span>
                  <span *ngIf="isGenerating" class="button-loading">
                    <span class="spinner-small"></span>
                    Generating...
                  </span>
                </button>
              </div>
            </form>
          </div>
  
        <!-- Diagram Tab Content -->
        <div class="diagram-container" *ngIf="activeTab === 'diagram'">
          <!-- Template Sidebar for Drag and Drop -->
          <div class="template-sidebar">
            <h4>Service Templates</h4>
            <p class="template-hint">Drag templates onto the canvas to create services</p>
            <div class="template-list">
              <div 
                *ngFor="let template of getAvailableTemplates()"
                class="template-item"
                (mousedown)="onTemplateMouseDown($event, template.name)"
                [class.dragging]="isDraggingTemplate && draggedTemplateName === template.name">
                <span class="template-icon">
                  <svg-icon [type]="template.icon"></svg-icon>
                </span>
                <span class="template-name">{{ template.displayName }}</span>
              </div>
            </div>
          </div>

          <div class="diagram-view" 
               (drop)="onDiagramDrop($event)"
               (dragover)="onDiagramDragOver($event)"
               (dragenter)="onDiagramDragEnter($event)"
               (dragleave)="onDiagramDragLeave($event)">
            <svg class="diagram-svg" #diagramSvg viewBox="0 0 1000 700" preserveAspectRatio="xMidYMid meet">
              <!-- Arrow marker definition -->
              <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                  <polygon points="0 0, 10 3, 0 6" fill="#007BFF" />
                </marker>
              </defs>
              <!-- Invisible drop zone overlay (behind everything, catches drops in empty areas) -->
              <rect x="0" y="0" width="1000" height="700" fill="transparent" 
                    style="pointer-events: all; cursor: copy;"
                    (drop)="onDiagramDrop($event)"
                    (dragover)="onDiagramDragOver($event)"
                    (dragenter)="onDiagramDragEnter($event)"></rect>
              <!-- Render edges first (behind nodes) -->
              <g class="edges" style="pointer-events: none;">
                <line
                  *ngFor="let edge of composeGraph.edges; trackBy: trackByEdge"
                  [attr.x1]="getNodePosition(edge.from)?.x || 0"
                  [attr.y1]="getNodePosition(edge.from)?.y || 0"
                  [attr.x2]="getNodePosition(edge.to)?.x || 0"
                  [attr.y2]="getNodePosition(edge.to)?.y || 0"
                  class="edge-line"
                  [attr.marker-end]="'url(#arrowhead)'">
                </line>
              </g>
              <!-- Render nodes (on top, can be clicked) -->
              <g class="nodes" style="pointer-events: none;">
                <g
                  *ngFor="let node of composeGraph.nodes; trackBy: trackByNode"
                  class="node-group"
                  [attr.transform]="'translate(' + (node.position?.x || 0) + ',' + (node.position?.y || 0) + ')'"
                  (click)="onNodeClick(node.id)"
                  [class.selected]="services[selectedServiceIndex] && node.id === services[selectedServiceIndex].serviceName"
                  style="pointer-events: all;">
                  <rect class="node-rect" width="120" height="80" rx="8" x="0" y="0"></rect>
                  <foreignObject x="0" y="0" width="120" height="80">
                      <div class="node-content" xmlns="http://www.w3.org/1999/xhtml">
                        <div class="node-icon-text">
                          <svg-icon [type]="getServiceIcon(node.data)"></svg-icon>
                        </div>
                        <div class="node-label-text">{{ node.label }}</div>
                      </div>
                  </foreignObject>
                </g>
              </g>
            </svg>
            <div class="diagram-empty" *ngIf="composeGraph.nodes.length === 0">
              <p>No services to display. Add services using the form or drag templates onto the canvas.</p>
            </div>
          </div>

          <!-- Feedback Prompt - Compact -->
          <div class="feedback-prompt-compact" *ngIf="activeTab === 'diagram' && composeGraph.nodes.length > 0 && !feedbackSubmitted">
            <div class="feedback-content-compact">
              <span class="feedback-question">Is this closer to a 'visual editor'?</span>
              <div class="feedback-buttons-compact" *ngIf="!showFeedbackComment">
                <button type="button" class="feedback-btn-compact yes" (click)="submitFeedback(true)">Yes</button>
                <button type="button" class="feedback-btn-compact no" (click)="submitFeedback(false)">No</button>
              </div>
              <div class="feedback-comment-section" *ngIf="showFeedbackComment">
                <textarea 
                  [(ngModel)]="feedbackComment"
                  placeholder="Tell us what you think..."
                  class="feedback-comment-compact"
                  rows="2"></textarea>
                <button 
                  type="button" 
                  class="feedback-submit-compact"
                  (click)="submitFeedbackComment()"
                  [disabled]="!feedbackComment.trim()">
                  Submit
                </button>
              </div>
            </div>
          </div>
          <div class="feedback-success-compact" *ngIf="feedbackSubmitted">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Thank you!</span>
          </div>
        </div>

      <!-- YAML Preview Tab Content -->
        <div class="yaml-preview" *ngIf="activeTab === 'yaml'">
          <div class="yaml-header">
            <h3>YAML Editor</h3>
            <div class="yaml-mode-controls">
              <button 
                type="button" 
                class="mode-toggle-btn"
                [class.active]="!yamlEditMode"
                (click)="yamlEditMode = false">
                Preview
              </button>
              <button 
                type="button" 
                class="mode-toggle-btn"
                [class.active]="yamlEditMode"
                (click)="enableYamlEditMode()">
                Edit
              </button>
              <button 
                type="button" 
                class="btn-copy-yaml"
                *ngIf="!yamlEditMode"
                (click)="copyYamlToClipboard()"
                title="Copy YAML to clipboard">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
              <button 
                type="button" 
                class="btn-sync-yaml"
                *ngIf="yamlEditMode"
                (click)="syncYamlToForm()"
                [disabled]="isSyncingYaml || yamlEditError">
                <span *ngIf="!isSyncingYaml">Sync to Form</span>
                <span *ngIf="isSyncingYaml" class="loading-text">
                  <span class="spinner-small"></span>
                  Syncing...
                </span>
              </button>
            </div>
          </div>
          
          <div class="yaml-error" *ngIf="yamlEditError">
            <strong>YAML Error:</strong> {{ yamlEditError }}
          </div>
          
          <div *ngIf="!yamlEditMode" class="yaml-preview-content">
            <pre><code>{{ yamlPreview || '# Your YAML will appear here...' }}</code></pre>
          </div>
          
          <div *ngIf="yamlEditMode" class="yaml-editor-content">
            <textarea 
              class="yaml-editor"
              [(ngModel)]="yamlEditContent"
              (input)="onYamlEdit()"
              placeholder="Edit your Docker Compose YAML here..."
              spellcheck="false"></textarea>
          </div>
        </div>
      </div>

      <!-- Commands Tab Content -->
        <div class="commands-tab" *ngIf="activeTab === 'commands'">
          <div class="commands-header">
          <h3>Docker Commands</h3>
          <p class="commands-description">Copy and run these commands in your terminal</p>
        </div>
        <div class="commands-list" *ngIf="services.length > 0">
          <!-- Docker Compose Up -->
          <div class="command-card">
            <div class="command-header">
              <div class="command-info">
                <h4>Start Services</h4>
                <p>Start all services in detached mode</p>
              </div>
              <button 
                type="button"
                class="btn-copy-command"
                (click)="copyCommandToClipboard('up')"
                title="Copy command">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
            </div>
            <div class="command-content">
              <code>{{ getDockerComposeCommand('up') }}</code>
            </div>
          </div>

          <!-- Docker Compose Down -->
          <div class="command-card">
            <div class="command-header">
              <div class="command-info">
                <h4>Stop Services</h4>
                <p>Stop and remove all containers</p>
              </div>
              <button 
                type="button"
                class="btn-copy-command"
                (click)="copyCommandToClipboard('down')"
                title="Copy command">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
            </div>
            <div class="command-content">
              <code>{{ getDockerComposeCommand('down') }}</code>
            </div>
          </div>

          <!-- Docker Compose Logs -->
          <div class="command-card">
            <div class="command-header">
              <div class="command-info">
                <h4>View Logs</h4>
                <p>View logs from all services</p>
              </div>
              <button 
                type="button"
                class="btn-copy-command"
                (click)="copyCommandToClipboard('logs')"
                title="Copy command">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
            </div>
            <div class="command-content">
              <code>{{ getDockerComposeCommand('logs') }}</code>
            </div>
          </div>

          <!-- Docker Compose Restart -->
          <div class="command-card">
            <div class="command-header">
              <div class="command-info">
                <h4>Restart Services</h4>
                <p>Restart all services</p>
              </div>
              <button 
                type="button"
                class="btn-copy-command"
                (click)="copyCommandToClipboard('restart')"
                title="Copy command">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
            </div>
            <div class="command-content">
              <code>{{ getDockerComposeCommand('restart') }}</code>
            </div>
          </div>

          <!-- Service-Specific Logs -->
          <div class="command-card" *ngFor="let service of services">
            <div class="command-header">
              <div class="command-info">
                <h4>Logs: {{ service.serviceName }}</h4>
                <p>View logs for {{ service.serviceName }} service</p>
              </div>
              <button 
                type="button"
                class="btn-copy-command"
                (click)="copyServiceLogsCommand(service.serviceName)"
                title="Copy command">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy
              </button>
            </div>
            <div class="command-content">
              <code>{{ getServiceLogsCommand(service.serviceName) }}</code>
            </div>
          </div>
        </div>
        <div class="commands-empty" *ngIf="services.length === 0">
          <p>Add services to generate Docker commands</p>
        </div>
      </div>
        </div>

    <!-- Save Template Modal -->
    <div class="modal-overlay" *ngIf="showSaveTemplateModal" (click)="closeSaveTemplateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Save as Template</h3>
          <button type="button" class="btn-close-modal" (click)="closeSaveTemplateModal()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="templateName">Template Name *</label>
            <input 
              type="text" 
              id="templateName"
              [(ngModel)]="templateName"
              placeholder="e.g., Web App with Database"
              [ngModelOptions]="{standalone: true}"
              class="form-input">
          </div>
          <div class="form-group">
            <label for="templateDescription">Description</label>
            <textarea 
              id="templateDescription"
              [(ngModel)]="templateDescription"
              placeholder="Describe what this template is used for..."
              [ngModelOptions]="{standalone: true}"
              rows="3"
              class="form-input"></textarea>
          </div>
          <div class="form-group">
            <label for="templateTags">Tags (comma-separated)</label>
            <input 
              type="text" 
              id="templateTags"
              [(ngModel)]="templateTags"
              placeholder="e.g., web, database, production"
              [ngModelOptions]="{standalone: true}"
              class="form-input">
            <small class="help-text">Separate tags with commas</small>
          </div>
          <div class="template-preview">
            <strong>This template will include:</strong>
            <ul>
              <li>{{ services.length }} service{{ services.length !== 1 ? 's' : '' }}</li>
              <li *ngFor="let service of services">{{ service.serviceName || 'Unnamed Service' }}</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeSaveTemplateModal()">Cancel</button>
          <button 
            type="button" 
            class="btn-primary" 
            (click)="saveTemplate()"
            [disabled]="isSavingTemplate || !templateName.trim()">
            <span *ngIf="!isSavingTemplate">Save Template</span>
            <span *ngIf="isSavingTemplate" class="button-loading">
              <span class="spinner-small"></span>
              Saving...
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Save Success Popup -->
    <div class="save-success-popup" *ngIf="showSaveSuccessPopup">
      <div class="success-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="success-icon">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <div class="success-text">
          <strong>Template Saved!</strong>
          <p>{{ savedTemplateName }}</p>
        </div>
        <button type="button" class="btn-close-success" (click)="closeSaveSuccessPopup()">√ó</button>
      </div>
    </div>

    <!-- Generate Success Popup -->
    <div class="save-success-popup" *ngIf="showGenerateSuccessPopup">
      <div class="success-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="success-icon">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <div class="success-text">
          <strong>Docker Compose File Generated!</strong>
          <p>Your docker-compose.yml file has been downloaded.</p>
        </div>
        <button type="button" class="btn-close-success" (click)="closeGenerateSuccessPopup()">√ó</button>
      </div>
    </div>

    <!-- Suggestions Popup -->
    <div class="suggestions-popup-overlay" *ngIf="showSuggestionsPopup" (click)="closeSuggestionsPopup()">
      <div class="suggestions-popup" (click)="$event.stopPropagation()">
        <div class="popup-header">
          <h3>
            <span class="suggestions-icon">üí°</span>
            Configuration Suggestions ({{ getConfigSuggestions().length }})
          </h3>
          <button type="button" class="btn-close-popup" (click)="closeSuggestionsPopup()">√ó</button>
        </div>
        <div class="popup-content">
          <div *ngFor="let suggestion of getConfigSuggestions()" class="suggestion-item-popup" [class]="'suggestion-' + suggestion.type">
            <div class="suggestion-header-popup">
              <span class="suggestion-icon">
                <span *ngIf="suggestion.type === 'error'">‚ùå</span>
                <span *ngIf="suggestion.type === 'warning'">‚ö†Ô∏è</span>
                <span *ngIf="suggestion.type === 'suggestion'">üí°</span>
                <span *ngIf="suggestion.type === 'optimization'">‚ö°</span>
              </span>
              <strong>{{ suggestion.title }}</strong>
              <span class="severity-badge" [class]="'severity-' + suggestion.severity">
                {{ suggestion.severity }}
              </span>
            </div>
            <p>{{ suggestion.message }}</p>
            <div class="suggestion-fix" *ngIf="suggestion.fix">
              <strong>Fix:</strong> {{ suggestion.fix }}
            </div>
          </div>
        </div>
        <div class="popup-footer">
          <button type="button" class="btn-open-learning" (click)="openLearningCenter(); closeSuggestionsPopup()">
            Open Learning Center
          </button>
        </div>
      </div>
    </div>
  </main>
  
    <!-- Onboarding Modal -->
    <div class="onboarding-overlay" *ngIf="showOnboardingModal" (click)="closeOnboardingModal()">
      <div class="onboarding-modal" (click)="$event.stopPropagation()">
        <div class="onboarding-header">
          <h2>Welcome to Docker Compose Editor</h2>
          <p>Let's get you started building Docker applications the easy way.</p>
        </div>
        <div class="onboarding-content">
          <div class="onboarding-options">
            <div class="onboarding-option" (click)="startFromTemplate()">
              <div class="option-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="9" y1="3" x2="9" y2="21"></line>
                  <line x1="3" y1="9" x2="21" y2="9"></line>
                </svg>
              </div>
              <h3>Start from Template</h3>
              <p>Choose a pre-configured template (Nginx, PostgreSQL, Redis, etc.) and customize it to your needs. Perfect for beginners!</p>
              <button type="button" class="btn-option">Start with Template</button>
            </div>
            <div class="onboarding-option" (click)="startFromScratch()">
              <div class="option-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </div>
              <h3>Start from Scratch</h3>
              <p>Build your Docker configuration from the ground up. We'll guide you through each step.</p>
              <button type="button" class="btn-option">Start Building</button>
            </div>
          </div>
          <div class="onboarding-features">
            <h4>What you can do:</h4>
            <ul>
              <li>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Build Docker applications visually - no YAML knowledge needed
              </li>
              <li>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Get real-time suggestions and tips as you build
              </li>
              <li>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                See your application structure in a visual diagram
              </li>
              <li>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Save your work as templates for later use
              </li>
            </ul>
          </div>
        </div>
        <div class="onboarding-footer">
          <button type="button" class="btn-skip" (click)="closeOnboardingModal()">Skip for now</button>
        </div>
      </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" *ngIf="showShareModal" (click)="closeShareModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Share Configuration</h2>
          <button type="button" class="btn-close-modal" (click)="closeShareModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <p>Share this link with others to let them view and use your Docker Compose configuration:</p>
          <div class="share-link-container">
            <input 
              type="text" 
              [value]="shareableLink"
              readonly
              class="share-link-input">
            <button 
              type="button"
              class="btn-copy-link"
              (click)="copyShareableLink()"
              title="Copy link">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <p class="share-note">Note: This link contains your full configuration. Anyone with the link can view it.</p>
        </div>
      </div>
    </div>

    <!-- Environment Management Modal -->
    <div class="modal-overlay" *ngIf="showEnvironmentModal" (click)="showEnvironmentModal = false">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Manage Environments</h2>
          <button type="button" class="btn-close-modal" (click)="showEnvironmentModal = false">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="environments-list">
            <div *ngIf="environments.length === 0" class="empty-state">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <p>No environments yet. Create your first environment below.</p>
            </div>
            <div *ngFor="let env of environments" class="environment-item">
              <div class="env-info">
                <strong>{{ env.name | titlecase }}</strong>
                <span *ngIf="env.profile" class="env-profile">Profile: {{ env.profile }}</span>
              </div>
              <button 
                type="button"
                class="btn-delete-env"
                (click)="deleteEnvironment(env.name)"
                [disabled]="env.name === 'base'"
                title="Delete environment">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </div>
          <div class="add-environment-form">
            <h3>Add New Environment</h3>
            <div class="form-group">
              <label for="new-env-name">Environment Name *</label>
              <input 
                type="text" 
                id="new-env-name"
                [(ngModel)]="newEnvironmentName"
                [ngModelOptions]="{standalone: true}"
                placeholder="e.g., staging, test"
                class="form-input">
            </div>
            <div class="form-group">
              <label for="new-env-profile">Docker Compose Profile <span class="optional-label">(optional)</span></label>
              <input 
                type="text" 
                id="new-env-profile"
                [(ngModel)]="newEnvironmentProfile"
                [ngModelOptions]="{standalone: true}"
                placeholder="e.g., staging, production"
                class="form-input">
              <small class="help-text">If specified, services will use this profile in the generated YAML</small>
            </div>
            <div class="form-actions">
              <button type="button" class="btn-secondary" (click)="showEnvironmentModal = false">Cancel</button>
              <button type="button" class="btn-primary" (click)="addEnvironment()" [disabled]="!newEnvironmentName.trim()">Add Environment</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Environment Diff Modal -->
    <div class="modal-overlay" *ngIf="showEnvironmentDiff" (click)="closeEnvironmentDiff()">
      <div class="modal-content modal-large" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Compare Environments</h2>
          <button type="button" class="btn-close-modal" (click)="closeEnvironmentDiff()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="diff-selectors">
            <div class="form-group">
              <label>Environment 1</label>
              <select 
                [(ngModel)]="diffEnvironment1"
                [ngModelOptions]="{standalone: true}"
                class="form-input">
                <option value="">Select environment...</option>
                <option *ngFor="let env of environments" [value]="env.name">{{ env.name | titlecase }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>Environment 2</label>
              <select 
                [(ngModel)]="diffEnvironment2"
                [ngModelOptions]="{standalone: true}"
                class="form-input">
                <option value="">Select environment...</option>
                <option *ngFor="let env of environments" [value]="env.name">{{ env.name | titlecase }}</option>
              </select>
            </div>
            <button 
              type="button" 
              class="btn-primary"
              (click)="openEnvironmentDiff()"
              [disabled]="!diffEnvironment1 || !diffEnvironment2 || diffEnvironment1 === diffEnvironment2">
              Compare
            </button>
          </div>
          <div class="diff-results" *ngIf="diffEnvironment1 && diffEnvironment2 && diffEnvironment1 !== diffEnvironment2">
            <div *ngFor="let serviceName of Object.keys(getEnvironmentDiff(diffEnvironment1, diffEnvironment2))" class="diff-service">
              <h4>{{ serviceName }}</h4>
              <div class="diff-table">
                <div class="diff-row diff-header">
                  <div class="diff-cell">Property</div>
                  <div class="diff-cell">{{ diffEnvironment1 | titlecase }}</div>
                  <div class="diff-cell">{{ diffEnvironment2 | titlecase }}</div>
                </div>
                <div *ngFor="let prop of Object.keys(getEnvironmentDiff(diffEnvironment1, diffEnvironment2)[serviceName])" class="diff-row">
                  <div class="diff-cell diff-property">{{ prop }}</div>
                  <div class="diff-cell">{{ getEnvironmentDiff(diffEnvironment1, diffEnvironment2)[serviceName][prop].env1 | json }}</div>
                  <div class="diff-cell">{{ getEnvironmentDiff(diffEnvironment1, diffEnvironment2)[serviceName][prop].env2 | json }}</div>
                </div>
              </div>
            </div>
            <div *ngIf="Object.keys(getEnvironmentDiff(diffEnvironment1, diffEnvironment2)).length === 0" class="no-diff">
              No differences found between these environments.
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>¬© 2025 ComposeFlow. All rights reserved. | <a routerLink="/privacy">Privacy Policy</a></p>
    </footer>